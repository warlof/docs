<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Package Development - SeAT Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Package Development";
    var mkdocs_page_input_path = "development/package_development.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> SeAT Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">General</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../contact/">Contact</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../reporting_bugs/">Reporting Bugs</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../community_packages/">Community Packages</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Installation Guides</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation_guides/getting_started/">Getting Started</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation_guides/quick_install/">Quick Install</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation_guides/generic_installation/">Generic Installation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation_guides/centos6/">CentOS 6.x</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation_guides/centos7/">CentOS 7.x</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation_guides/ubuntu16x/">Ubuntu 16.x</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation_guides/developer_installation/">Development Project</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Upgrade Guides</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../upgrade_guides/general_upgrades/">General Upgrades</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../upgrade_guides/seat1_to_2/">SeAT 1.x to SeAT 2.0</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Email</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../email/mailgun/">Mailgun Setup</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../email/gmail/">Gmail Setup</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Admin Guides</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../admin_guides/sso/">Configuring Eve Online SSO</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../admin_guides/scaling_seat/">Scaled SeAT Deployments</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../admin_guides/rbac/">Role Based Access Control</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../admin_guides/tracking/">Understanding Tracking</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../admin_guides/seat_supervisor/">SeAT & Supervisor Integration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../admin_guides/eveapi_admin_contact/">EVE Api Administrative Contact</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">SeAT API</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../seat_api/overview/">Overview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../seat_api/eve_api_keys/">EVE Api Keys</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../seat_api/seat_users/">SeAT Users</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../seat_api/roles_permissions/">SeAT Roles, Permissions and Authorization</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../seat_api/characters/">Characters</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../seat_api/corporations/">Corporations</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Changelogs</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../changelogs/api/">Api</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../changelogs/console/">Console</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../changelogs/eveapi/">Eveapi</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../changelogs/notifications/">Notifications</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../changelogs/services/">Services</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../changelogs/web/">Web</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Package Configurations</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/overview/">Overview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/api/">Api</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/console/">Console</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/eveapi/">Eveapi</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/notifications/">Notifications</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/service/">Service</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/web/">Web</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/other/">Other</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Eve XML API Updater</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../eve_xml_api_updater/job_queue_flow/">Job Queue Flow</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Developing For SeAT</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../general/">General Guide</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../package_breakdown/">Core Package Breakdown</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Package Development</a>
    <ul class="current">
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../todo/">TODO List</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">SeAT Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Developing For SeAT &raquo;</li>
        
      
    
    <li>Package Development</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/eveseat/docs/edit/master/docs/development/package_development.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p><img alt="SeAT" src="http://i.imgur.com/aPPOxSK.png" /></p>
<h2 id="introduction">introduction</h2>
<p>So, you want to write a SeAT package? Hopefully this guide helps you along the way!<br />
This guide was written while writing the API package for SeAT <a href="https://github.com/eveseat/api">here</a>. I figured it would be best to try and capture the process as I am going through it to help in case I miss any important details.</p>
<h2 id="toc">toc</h2>
<ol>
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="#service-provider">Service Provider</a></li>
<li><a href="#package-structure">Package Structure</a></li>
<li><a href="#routes-and-controllers">Routes and Controllers</a></li>
<li><a href="#routes---access-control">Routes - Access Control</a></li>
<li><a href="#middleware">Middleware</a></li>
<li><a href="#views">Views</a></li>
<li><a href="#views---sidebar-menu">Views - Sidebar Menu</a></li>
<li><a href="#views---character-submenus">Views - Character Menu</a></li>
<li><a href="#views---corporation-submenus">Views - Corporation Menu</a></li>
<li><a href="#views---bootstrapping-menu-items">Views - Bootstrapping Menu Items</a></li>
<li><a href="#database">Database</a></li>
</ol>
<h2 id="background-notes">background notes</h2>
<p>I think its important to keep in mind a few things about how SeAT is put together. The most important being a brief description of what each core package offers, and how you can integrate with them. For a breakdown on what the core packages provide, please refer the to breakdown <a href="Core-Package-Breakdown">here</a>.</p>
<p>SeAT 1.x is written on <a href="http://laravel.com/docs/5.1">Laravel 5.1 LTS</a>. A <strong>very</strong> good thing to do would be to actually read the documentation top-&gt;bottom and get an idea of what is possible with the framework. SeAT core packages make heavy use of many of the features, based directly of what has been interpreted by this very documentation.</p>
<p>If you really want to start contributing packages, but juts cant get your head around this whole Laravel thing, then I can suggest you have a look at this excellent free course material covering the basics of what you will encounter in the SeAT codebase. <a href="https://laracasts.com/series/laravel-5-fundamentals">https://laracasts.com/series/laravel-5-fundamentals</a></p>
<h2 id="getting-started">getting started</h2>
<p>The very first thing to do is prepare the empty git repository on say Github, as well as the composer package itself. Clone a clean repo, and run <code>composer init</code>, answering any questions. Once that is done, edit the resultant <code>composer.json</code> and prepare the <code>autoload</code> block. SeAT core follows the <a href="http://www.php-fig.org/psr/psr-4/">PSR-4</a> autoloading standard. I will suggest you do the same. For some more detailed composer info, refer to the docs <a href="https://getcomposer.org/doc/01-basic-usage.md">here</a>. For the API package, I am going to autoload <strong>Seat\Api</strong> from the <code>src</code> directory using PSR-4.</p>
<h2 id="service-provider">service provider</h2>
<p>As mentioned in the package breakdowns <a href="Core-Package-Breakdown">here</a>, the <em>eveseat/seat</em> repository bootstraps the packages via service providers. This is actually a Laravel convention that SeAT just follows. To get our package ready, we need to create a service provider. Thankfully there is a command to stub a new one for us. For the API package, I just ran <code>php artisan make:provider ApiServiceProvider</code> and copied the resultant file from <code>app/Providers</code> to my packages <code>src/</code> directory. Our packages file structure now looks as follows:</p>
<pre><code class="text">├── composer.json
└── src
    └── ApiServiceProvider.php
</code></pre>

<h2 id="package-structure">package structure</h2>
<p>From here you pretty much free to do what you want. How you structure the package will obviously depend on what exactly your package provides. In principle, I prefer to follow the same package structure as Laravel does for web / console features. Since we are going to be providing web features with the API, we will quickly create a few folders in preparation for this. I know beforehand that we are going to need a model to store API tokens; middleware to authenticate API requests; routes and controllers for the actual api logic (preferably making use of the <em>eveapi/services</em> repository classes for data access) as well as a few web views for administrators to generate API tokens for applications. With that in mind, the initial structure looks as follows:</p>
<pre><code>├── composer.json
└── src
    ├── ApiServiceProvider.php
    ├── Config
    ├── Http
    │   ├── Controllers
    │   └── Middleware
    ├── Models
    ├── database
    │   └── migrations
    └── resources
        └── views
</code></pre>

<p>This will obviously change as we progress making the package.</p>
<h2 id="routes-and-controllers">routes and controllers</h2>
<p>To start testing the API, we need to add a route and controller to process some requests and responses. My routes.php will have a global <code>Route::group()</code> to encapsulate the routes in the <strong>Seat\Api</strong> namespace as well as prefix them with <code>api/</code>.</p>
<pre><code class="php">// File: routes.php
Route::group([
    'namespace' =&gt; 'Seat\Api\Http\Controllers',
    'prefix' =&gt; 'api'
], function () {

    // Logic here
});
</code></pre>

<p>See the final product <a href="https://github.com/eveseat/api/blob/master/src/Http/routes.php">here</a> for a more complete example.</p>
<p>Next, I add some logic with a route to <code>/</code>, update the base frameworks <code>composer.json</code> to autoload the <strong>Seat\Api</strong> namespace from the directory where my package lives, run <code>composer dump-autoload</code> and add the service provider to the <em>eveseat/seat</em> repositories <code>app.php</code> providers array. Lastly, I add a method to the service provider to load the routes and call it form the <code>boot()</code> method in the generated stub.</p>
<p>See the complete service provider <a href="https://github.com/eveseat/api/blob/master/src/ApiServiceProvider.php">here</a></p>
<pre><code class="php">/**
* Include the routes
*/
public function add_routes()
{

    if (!$this-&gt;app-&gt;routesAreCached()) {
        include __DIR__ . '/Http/routes.php';
    }
}
</code></pre>

<p>As a final test, I check that my route is accessible from a booted SeAT app. :)  </p>
<h2 id="routes-access-control">routes - access control</h2>
<p>Obviously, some routes are not for everyones eyes. SeAT comes with middleware that can be used to filter out requests that may not be authorized for your route. As can be seen in the example below (from <a href="https://github.com/eveseat/api/blob/master/src/Http/routes.php#L28">here</a>), we are filtering out requests to <code>api-admin</code> for only superusers.</p>
<pre><code class="php">Route::group([
        'namespace'  =&gt; 'Admin',
        'middleware' =&gt; 'bouncer:superuser', // The ACL specification.
        'prefix'     =&gt; 'api-admin'
    ], function () {
        Route::get('/', [
            'as'   =&gt; 'api-admin.list',
            'uses' =&gt; 'ApiAdminController@listTokens']);
    });
</code></pre>

<p>I suggest you have a look at the <code>eveseat/web</code> packages routes definitions for more examples on how the middlewares are used. <a href="https://github.com/eveseat/web/tree/master/src/Http/Routes">https://github.com/eveseat/web/tree/master/src/Http/Routes</a></p>
<h2 id="middleware">middleware</h2>
<p>To auth our API requests, we are going to go with token based authentication for now. We want users to present us with a <code>X-Token</code> header (from a valid allowed src IP address) before they may proceed with their request. To do this, we will filter requests using middleware. Thankfully, again, Laravel comes with a command to stub us some empty middleware. Run <code>php artisan make:middleware ApiToken</code> and copy it to your projects <code>Middleware</code> folder. Next we should register the middleware in our service provider. I do this by adding a method and calling it in <code>boot()</code>.</p>
<p>See the complete middleware <a href="https://github.com/eveseat/api/blob/master/src/Http/Middleware/ApiToken.php">here</a></p>
<pre><code class="php">/**
 * Include the middleware needed
 *
 * @param $router
 */
public function add_middleware($router)
{

    // Authenticate checks that the token is valid
    // from an allowed IP address
    $router-&gt;middleware('api.auth', ApiToken::class);

}
</code></pre>

<h2 id="views">views</h2>
<p>Although almost all of our interfacing with this package will be via the json api endpoints, we need to add a few routes that will give an administrator the ability to generate API tokens, as well as view logs etc. As mentioned, this will be for an administrator, so we will re-use the ACL features provided by the <code>eveseat/web</code> package to ensure that only admins an access our api-admin routes.<br />
Views live in <code>resources/views</code> and are bootstrapped to the <code>api</code> namespace in the service provider. See the service provider <a href="https://github.com/eveseat/api/blob/master/src/ApiServiceProvider.php">here</a> for an example.</p>
<p>Note how we are re-using views that exist in the <code>web</code> namespace. All we have to do is extend one of the <a href="https://github.com/eveseat/web/tree/master/src/resources/views/layouts/grids">grids</a> like <a href="https://github.com/eveseat/api/blob/master/src/resources/views/list.blade.php#L1">here</a> and start without our blade template.</p>
<h2 id="views-sidebar-menu">views - sidebar menu</h2>
<p>Integrating with the sidebar is also really easy. All you have to do is create a config file, bootstrap it in the service provider and viola. The config file itself has a set structure for the <code>web</code> package to interpret and can be seen <a href="https://github.com/eveseat/api/blob/master/src/Config/package.sidebar.php">here</a>.</p>
<pre><code class="php">return [
    'api' =&gt; [
        'permission'    =&gt; 'Superuser',
        'name'          =&gt; 'Api Tokens',
        'icon'          =&gt; 'fa-exchange',
        'route_segment' =&gt; 'api-admin',
        'entries'       =&gt; [
            [   // Manage API Tokens
                'name'  =&gt; 'Manage',
                'icon'  =&gt; 'fa-key',
                'route' =&gt; 'api-admin.list'
            ]
        ]
    ]
];
</code></pre>

<p>The format is generally an array, whereby the first key is the name of your package (<code>api</code> in this case). Thereafter you can specify the main entry, and any sub entries you want to add. The <code>route</code> key should refer to the named route. The sidebar loader will resolve the route itself for you. If you have any permissions requirements for your package, the <code>permission</code> key can be used together with a required SeAT permission to render the view.</p>
<h2 id="views-character-submenus">views - character submenus</h2>
<p>Integrating with the character sub menus is also really easy. Just like the sidebar, all you have to do is create a config file, bootstrap it in the service provider and viola. The namespace should be named <code>package.character.menu</code> in your service provider. A sample config file can be seen below:</p>
<pre><code class="php">// file: package.character.menu.php

return [
    [
        'name'           =&gt; 'Research',
        'permission'     =&gt; 'character.research',
        'highlight_view' =&gt; 'research',
        'route'          =&gt; 'character.view.research'
    ]
];
</code></pre>

<h2 id="views-corporation-submenus">views - corporation submenus</h2>
<p>Integrating with the corporation sub menus is also really easy. Just like the sidebar and character menus, all you have to do is create a config file, bootstrap it in the service provider and viola. The namespace should be named <code>package.corporation.menu</code> in your service provider. A sample config file can be seen below:</p>
<pre><code class="php">// file: package.corporation.menu.php

return [
    [
        'name'           =&gt; 'Research',
        'permission'     =&gt; 'corporation.research',
        'highlight_view' =&gt; 'research',
        'route'          =&gt; 'corporation.view.research'
    ]
];
</code></pre>

<h2 id="views-bootstrapping-menu-items">views - bootstrapping menu items</h2>
<p>In the above items, we refer to the files needing to be <em>bootstrapped</em> via the service provider. All this really means is that we have to tell the Laravel application where to find configuration information for a namespace. So, if we wanted to add a sidebar item, we would add the following line to the <code>register()</code> method of the service provider:</p>
<pre><code class="php">// Include this packages menu items
$this-&gt;mergeConfigFrom(__DIR__ . '/Config/package.sidebar.php', 'package.sidebar');
</code></pre>

<p>The first argument is the file with the sidebar definitions, the second is the namespace.</p>
<h2 id="database">database</h2>
<p>For our API package, we have a database requirement. We need to store api tokens and the ip address that is allowed to use them. We are also going to store an access log (based on the config setting). We create migrations and models just like you would for a base Laravel 5.1 application. The only thing to remember is that your migrations for your package must be published (and specified in your service provider).</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../todo/" class="btn btn-neutral float-right" title="TODO List">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../package_breakdown/" class="btn btn-neutral" title="Core Package Breakdown"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/eveseat/docs/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../package_breakdown/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../todo/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
