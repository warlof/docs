<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>SeAT 1.x to SeAT 2.0 - SeAT Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "SeAT 1.x to SeAT 2.0";
    var mkdocs_page_input_path = "upgrade_guides/seat1_to_2.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> SeAT Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">General</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../contact/">Contact</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../reporting_bugs/">Reporting Bugs</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../community_packages/">Community Packages</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Installation Guides</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation_guides/getting_started/">Getting Started</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation_guides/quick_install/">Quick Install</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation_guides/generic_installation/">Generic Installation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation_guides/centos6/">CentOS 6.x</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation_guides/centos7/">CentOS 7.x</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation_guides/ubuntu16x/">Ubuntu 16.x</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation_guides/developer_installation/">Development Project</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Upgrade Guides</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../general_upgrades/">General Upgrades</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">SeAT 1.x to SeAT 2.0</a>
    <ul class="current">
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Email</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../email/mailgun/">Mailgun Setup</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../email/gmail/">Gmail Setup</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Admin Guides</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../admin_guides/sso/">Configuring Eve Online SSO</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../admin_guides/scaling_seat/">Scaled SeAT Deployments</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../admin_guides/rbac/">Role Based Access Control</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../admin_guides/tracking/">Understanding Tracking</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../admin_guides/seat_supervisor/">SeAT & Supervisor Integration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../admin_guides/eveapi_admin_contact/">EVE Api Administrative Contact</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">SeAT API</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../seat_api/overview/">Overview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../seat_api/eve_api_keys/">EVE Api Keys</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../seat_api/seat_users/">SeAT Users</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../seat_api/roles_permissions/">SeAT Roles, Permissions and Authorization</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../seat_api/characters/">Characters</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../seat_api/corporations/">Corporations</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Changelogs</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../changelogs/api/">Api</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../changelogs/console/">Console</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../changelogs/eveapi/">Eveapi</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../changelogs/notifications/">Notifications</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../changelogs/services/">Services</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../changelogs/web/">Web</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Package Configurations</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/overview/">Overview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/api/">Api</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/console/">Console</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/eveapi/">Eveapi</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/notifications/">Notifications</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/service/">Service</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/web/">Web</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/other/">Other</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Eve XML API Updater</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../eve_xml_api_updater/job_queue_flow/">Job Queue Flow</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Developing For SeAT</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../development/general/">General Guide</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../development/package_breakdown/">Core Package Breakdown</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../development/package_development/">Package Development</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../todo/">TODO List</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">SeAT Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Upgrade Guides &raquo;</li>
        
      
    
    <li>SeAT 1.x to SeAT 2.0</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/eveseat/docs/edit/master/docs/upgrade_guides/seat1_to_2.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p><img alt="SeAT" src="http://i.imgur.com/aPPOxSK.png" /></p>
<p>The upgrade path from SeAT 1.x to SeAT 2.0 requires some manual work. This is mainly due to the number of fundamental changes that were made in the SeAT 2.x release.</p>
<h2 id="notes-on-the-upgrade">notes on the upgrade</h2>
<p>The way SeAT is structured has not changed much since its version 1x days. The biggest change is a Laravel framework upgrade to version 5.3. This introduced a new base layout for the application which is why the manual upgrade is needed.</p>
<p>The upgrade process has a large amount of database migrations that need to run so grab a coffee depending on how big your database is!</p>
<h2 id="requirements">requirements</h2>
<ul>
<li>SeAT 2.0 requires PHP 7.0. At the time of writing this document, PHP 7.1 is not supported due to bug in PhealNG (the component SeAT uses to talk to the EVE API).</li>
<li>MySQL 5.7 is recommended but not required.</li>
<li>A database backup is an absolute <strong>must</strong>. Everything in SeAT can be recovered is some way or form <em>except for your database</em>. Make 100% sure you backed this up before proceeding with the upgrade!</li>
<li>Take note of where SeAT is installed. This is usually in <code>/var/www/seat</code>.</li>
</ul>
<h2 id="upgrade-procedure">upgrade procedure</h2>
<h3 id="preparation">preparation</h3>
<p>If users are using your SeAT instance, or the workers are churning away in the background, then you may risk losing some information (although unlikely). Its therefore recommended that you start by putting SeAT into maintenance mode before starting the upgrade. Do this by running the following command in your SeAT path.</p>
<pre><code>$ cd /var/www/seat
$ php artisan down
</code></pre>

<p>You should see the message <em>Application is now in maintenance mode.</em>.</p>
<h3 id="backups">backups</h3>
<ul>
<li>Make a backup of your SeAT database and store it somewhere safe! <strong>Do not skip this step!</strong></li>
<li>In your SeAT directory, make a copy of the <code>.env</code> file. This file contains all of your SeAT configuration. These values are needed to reconnect to the database once SeAT 2.0 is installed.</li>
</ul>
<h3 id="php-7">php 7</h3>
<p>Install PHP7 if you don't have it already. You can check your PHP version by running <code>php -v</code>:</p>
<pre><code>$ php -v
PHP 7.0.14 (cli) (built: Dec  7 2016 10:25:25) ( NTS )
Copyright (c) 1997-2016 The PHP Group
Zend Engine v3.0.0, Copyright (c) 1998-2016 Zend Technologies
</code></pre>

<h3 id="get-the-new-code">get the new code</h3>
<p>SeAT 2.0 can be installed in exactly the same place as where you had your v1.x installation. If you reuse this path then no webserver re-configuration will be needed. We will move the old installation out of the way, and install SeAT 2.0. To do this, run the following commands:</p>
<ul>
<li>First, move the old installation out of the way:</li>
</ul>
<pre><code>$ cd /var/www
$ mv seat seat.old
</code></pre>

<p>You can double check that this was successful by running <code>ls</code> and ensuring that there is a folder named <code>seat.old</code> now.</p>
<ul>
<li>Next, get the new SeAT code by running <code>composer create-project eveseat/seat seat --no-dev</code>:</li>
</ul>
<pre><code>$ cd /var/www
$ composer create-project eveseat/seat seat --no-dev
Installing eveseat/seat (2.0.0)
  - Installing eveseat/seat (2.0.0)
    Loading from cache

Created project in seat
&gt; php -r &quot;file_exists('.env') || copy('.env.example', '.env');&quot;
Loading composer repositories with package information
Updating dependencies

[ ... snip ... ]
</code></pre>

<h3 id="publish-the-assets">publish the assets</h3>
<p>Next, we need to publish the new SeAT 2.0 CSS &amp; Javascript and database migrations. This can be done with <code>php artisan vendor:publish --force</code>.</p>
<h3 id="reconfigure-env-file">reconfigure <code>.env</code> file</h3>
<p>With the new code ready to use, the next thing that is required is to reconnect the database. Remember that <code>.env</code> file you backed up earlier? Refer to it for the values needed in the newly installed env file that can be found at <code>/var/www/seat/.env</code>.</p>
<p>Important keys to populate with the correct values are:</p>
<pre><code>DB_HOST=
DB_PORT=
DB_DATABASE=
DB_USERNAME=
DB_PASSWORD=
</code></pre>

<p>SeAT 2.0 introduced new configuration items in the <code>.env</code> that you can review. There is also the option to configure Supervisor &amp; SeAT integration, which can be done by following the admin guide titled <em>SeAT &amp; Supervisor Integration</em>.</p>
<h3 id="run-migrations">run migrations</h3>
<p>With the database reconnected, its time to run the migrations for SeAT 2.0. This is the part that may take some time, depending on how big your database is.</p>
<p>To run the migrations, make sure you are still in your seat path (<code>/var/www/seat</code>) and run <code>php artisan migrate</code>:</p>
<pre><code>$ cd /var/www/seat
$ php artisan migrate
</code></pre>

<p>You will see a bunch of messages and eventually your shell prompt again, indicating that it has completed. If you receive errors here, double check that you have entered the correct database settings in the <code>.env</code> file previously mentioned.</p>
<h3 id="database-seeders">database seeders</h3>
<p>With the database migration complete, its time to seed it with some of the static data SeAT needs. Do this with the following commands:</p>
<pre><code>php artisan db:seed --class=Seat\\Notifications\\database\\seeds\\ScheduleSeeder
php artisan db:seed --class=Seat\\Services\\database\\seeds\\NotificationTypesSeeder
php artisan db:seed --class=Seat\\Services\\database\\seeds\\ScheduleSeeder
</code></pre>

<h3 id="update-worker-jobs">update worker jobs</h3>
<p>The Laravel 5.3 upgrade in SeAT changed the way worker jobs are started. You can edit the command used to start a worker in your <code>seat.conf</code> file in supervisor. Normally, this file will be somewhere like in <code>/etc/supervisor/conf.d/</code>.</p>
<p>The only line you really need to edit is the one that starts with <code>command</code>, replacing it with: <code>command=/usr/bin/php /var/www/seat/artisan queue:work --queue=high,medium,low,default --tries 1 --timeout=86100</code>.</p>
<p>A full block for SeAT 2.0 should therefore be:</p>
<pre><code>[program:seat]
command=/usr/bin/php /var/www/seat/artisan queue:work --queue=high,medium,low,default --tries 1 --timeout=86100
process_name = %(program_name)s-80%(process_num)02d
stdout_logfile = /var/log/seat-80%(process_num)02d.log
stdout_logfile_maxbytes=100MB
stdout_logfile_backups=10
numprocs=4
directory=/var/www/seat
stopwaitsecs=600
user=www-data
</code></pre>

<p><strong>NOTE</strong> Keep in mind the <code>user</code> value and the path to <code>artisan</code> should be correct. Update them to the correct values of you made changes to the defaults. The <code>user</code> value differs many times based on Linux distribution too!</p>
<h3 id="finishing-off">finishing off</h3>
<p>With all of that done, bring your application back up with <code>php artisan up</code> and start the supervisor workers again. Watch the logs for any errors in case things have not gone as expected. If you need any help, feel free to join the Slack channel details in the <em>Contact</em> page on the left.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../email/mailgun/" class="btn btn-neutral float-right" title="Mailgun Setup">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../general_upgrades/" class="btn btn-neutral" title="General Upgrades"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/eveseat/docs/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../general_upgrades/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../email/mailgun/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
