<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>SeAT & Supervisor Integration - SeAT Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "SeAT & Supervisor Integration";
    var mkdocs_page_input_path = "admin_guides/seat_supervisor.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> SeAT Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">General</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../contact/">Contact</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../reporting_bugs/">Reporting Bugs</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../community_packages/">Community Packages</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Installation Guides</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation_guides/getting_started/">Getting Started</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation_guides/quick_install/">Quick Install</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation_guides/generic_installation/">Generic Installation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation_guides/centos6/">CentOS 6.x</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation_guides/centos7/">CentOS 7.x</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation_guides/ubuntu16x/">Ubuntu 16.x</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation_guides/developer_installation/">Development Project</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Upgrade Guides</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../upgrade_guides/general_upgrades/">General Upgrades</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../upgrade_guides/seat1_to_2/">SeAT 1.x to SeAT 2.0</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Email</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../email/mailgun/">Mailgun Setup</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../email/gmail/">Gmail Setup</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Admin Guides</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../sso/">Configuring Eve Online SSO</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../scaling_seat/">Scaled SeAT Deployments</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../rbac/">Role Based Access Control</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../tracking/">Understanding Tracking</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">SeAT & Supervisor Integration</a>
    <ul class="current">
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../eveapi_admin_contact/">EVE Api Administrative Contact</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">SeAT API</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../seat_api/overview/">Overview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../seat_api/eve_api_keys/">EVE Api Keys</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../seat_api/seat_users/">SeAT Users</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../seat_api/roles_permissions/">SeAT Roles, Permissions and Authorization</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../seat_api/characters/">Characters</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../seat_api/corporations/">Corporations</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Changelogs</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../changelogs/api/">Api</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../changelogs/console/">Console</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../changelogs/eveapi/">Eveapi</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../changelogs/notifications/">Notifications</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../changelogs/services/">Services</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../changelogs/web/">Web</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Package Configurations</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/overview/">Overview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/api/">Api</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/console/">Console</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/eveapi/">Eveapi</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/notifications/">Notifications</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/service/">Service</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/web/">Web</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/other/">Other</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Eve XML API Updater</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../eve_xml_api_updater/job_queue_flow/">Job Queue Flow</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Developing For SeAT</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../development/general/">General Guide</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../development/package_breakdown/">Core Package Breakdown</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../development/package_development/">Package Development</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../todo/">TODO List</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">SeAT Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Admin Guides &raquo;</li>
        
      
    
    <li>SeAT & Supervisor Integration</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/eveseat/docs/edit/master/docs/admin_guides/seat_supervisor.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p><img alt="SeAT" src="http://i.imgur.com/aPPOxSK.png" /></p>
<h2 id="introduction">introduction</h2>
<p>SeAT is able to query a supervisor instance for worker statuses and other information. This information can then be displayed in the <em>Queue Status</em> screen.</p>
<p><img alt="seat supervisor" src="https://i.imgur.com/fCnYQ08.png" /></p>
<h2 id="requirements">requirements</h2>
<p>Supervisor monitoring needs Supervisor version 3.0 or later. Check your supervisor version with <code>supervisord -v</code>. If you are running CentOS 6, please refer to the <a href="#updating-supervisor-on-centos-6">updating supervisor on centos 6</a> section below before continuing.</p>
<h2 id="the-config">the config</h2>
<p>A bit of setup work is needed in order to have your SeAT setup query a supervisor instance. The basic idea to get this working is:</p>
<ul>
<li>Add a <code>[inet_http_server]</code> configuration block to your <code>supervisor.conf</code> file and restart supervisor.</li>
<li>Add the username, password, ip and port of the supervisor instance to your SeAT <code>.env</code> configuration file.</li>
</ul>
<h2 id="1-add-supervisor-configuration-block">1. add supervisor configuration block.</h2>
<p>On your server where <code>supervisor</code> is running, open the configuration file <code>/etc/supervisor/supervisord.conf</code> in your favorite text editor. Add the following configuration block to your configuration file:</p>
<pre><code>[inet_http_server]
port=127.0.0.1:9001
username=seat
password=your_secure_password
</code></pre>

<p>Obviously, substitute the values with those that correspond with your environment. For most setups, the values in the example should be just fine.</p>
<p><img alt="seat supervisor config" src="https://i.imgur.com/6jVLsLv.png" /></p>
<p>Finally, restart supervisor itself.</p>
<h2 id="2-configure-seat-with-the-new-values">2. configure SeAT with the new values.</h2>
<p>SeAT itself also needs some configurations added in order for it to know where the supervisor instance is, as well as what password to use when querying for status information.</p>
<p>Again, on your server, find your SeAT installations <code>.env</code> file (usually located at <code>/var/www/seat/.env</code>) and add the following configuration block:</p>
<pre><code>SUPERVISOR_RPC_ADDRESS=127.0.0.1
SUPERVISOR_RPC_USERNAME=seat
SUPERVISOR_RPC_PASSWORD=hd@rjf&amp;@921aJlw0
SUPERVISOR_RPC_PORT=9001
SUPERVISOR_GROUP=seat
</code></pre>

<p>The defaults here should also be sufficient but feel free to adjust as needed.</p>
<h3 id="updating-supervisor-on-centos-6">updating supervisor on centos 6</h3>
<p>CentOS 6 ships with supervisor 2x by default. In order to get the supervisor monitoring to work, the following steps may be followed to upgrade your supervisor version.</p>
<ul>
<li>Install the <a href="http://ghettoforge.org/">GhettoForge</a> repository. This can be done with:</li>
</ul>
<pre><code># Download and install the latest release
GF=gf-release-6-10.gf.el6.noarch.rpm &amp;&amp; curl -O http://mirror.symnds.com/distributions/gf/el/6/gf/x86_64/$GF &amp;&amp; yum localinstall -y $GF &amp;&amp; rm -f $GF

# Import the GhettoForge signing keys
rpm --import http://mirror.symnds.com/distributions/gf/RPM-GPG-KEY-gf.el6

# Enable the repository
yum install yum-utils -y
yum-config-manager --enable gf-plus
</code></pre>

<ul>
<li>Next, install Supervisor by running <code>yum install supervisor -y</code></li>
</ul>
<p>This will update your local installation to version 3x. Your old configuration will be saved in <code>/etc/supervisord.conf.rpmsave</code>. Supervisor 3 allows you to specify a <code>numprocs</code> setting in a command block instead of having to define multiple instances like you had to do with v2.x. You will need to create a file called <code>seat.ini</code> in <code>/etc/supervisord.d/</code>. This file should look something like this:</p>
<pre><code>[program:seat]
command=/usr/bin/php /var/www/seat/artisan queue:work --queue=high,medium,low,default --tries 1 --timeout=604800
process_name = %(program_name)s-80%(process_num)02d
stdout_logfile = /var/log/seat-80%(process_num)02d.log
stdout_logfile_maxbytes=100MB
stdout_logfile_backups=10
numprocs=6
directory=/var/www/seat
stopwaitsecs=600
user=apache
</code></pre>

<ul>
<li>Restart supervisor with <code>/etc/init.d/supervisord restart</code> and check that your workers are running again with <code>supervisorctl status</code>.</li>
</ul>
<h2 id="troubleshooting">troubleshooting</h2>
<p>In case something goes wrong, you have a few debugging options.</p>
<ul>
<li>Obviously, first ensure that <code>supervisor</code> itself is running.</li>
<li>If the http interface is started on a remote server, ensure that no firewall is blocking TCP traffic to the destination server.</li>
<li>If you just added the <code>inet_http_server</code> configuration block, restart supervisor and then check back on the web interface.</li>
<li>Attempt to debug the connection using the <a href="#troubleshooting-tinker-console">tinker</a> example below.</li>
<li>Hop onto Slack (details in the contact page) for help.</li>
</ul>
<h2 id="troubleshooting-tinker-console">troubleshooting - tinker console</h2>
<p>Another option you have to try and figure out why your supervisor integration might not be working would be to attempt to mimic the calls SeAT makes to supervisor and looking for errors.</p>
<p>Don't worry, this is easier than it looks!</p>
<p>First, drop into a <code>tinker</code> shell by running <code>php artisan tinker</code>. This will drop you into a fully booted instance of SeAT:</p>
<p><img alt="seat tinker" src="https://i.imgur.com/eohUSMz.png" /></p>
<p>Next, copy and paste the following instantiation code into the console. This will initialize the object needed to connect to the supervisor <code>inet_http_server</code> using the configuration in your <code>.env</code> config file:</p>
<pre><code>$supervisor = new Supervisor\Supervisor(config('web.supervisor.name'), config('web.supervisor.rpc.address'), config('web.supervisor.rpc.username'), config('web.supervisor.rpc.password'), (int) config('web.supervisor.rpc.port'));
</code></pre>

<p>Pasting that should result in output similar to the below screenshot:</p>
<p><img alt="seat tinker supervisor init" src="https://i.imgur.com/s2vmf3A.png" /></p>
<p>Finally, attempt to get the current running processes by running the following code:</p>
<pre><code>$supervisor-&gt;getProcesses();
</code></pre>

<p>As you can see in my example below, the object is unable to connect to the supervisor inet_http_server. This could indicate a number of things and should hopefully help with troubleshooting any errors that may occur.</p>
<p><img alt="seat tinker supervisor init" src="https://i.imgur.com/PJC02j4.png" /></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../eveapi_admin_contact/" class="btn btn-neutral float-right" title="EVE Api Administrative Contact">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../tracking/" class="btn btn-neutral" title="Understanding Tracking"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/eveseat/docs/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../tracking/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../eveapi_admin_contact/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
